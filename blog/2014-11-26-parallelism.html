<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <title>Parallelism - 记往开来</title>
  <meta name="author" content="Xiao Liu">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://xiaoliuai.github.io/blog/2014-11-26-parallelism.html">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="记往开来" type="application/atom+xml">

  <!-- http://opengraphprotocol.org/ -->
  <meta name="twitter:card" content="summary_large_image">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://xiaoliuai.github.io/blog/2014-11-26-parallelism.html">
  <meta property="og:title" content="Parallelism - 记往开来">
  

  <script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>

<link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">


  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

  

</head>

  <body   >
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">记往开来</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a rel="index" href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="https://www.google.com/search" method="GET">
                    <input type="hidden" name="q" value="site:xiaoliuai.github.io">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" role="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9" itemscope itemtype="http://schema.org/Blog">
    <meta itemprop="name" content="记往开来" />
    
    <meta itemprop="url" content="http://xiaoliuai.github.io" />
    <article class="hentry" role="article" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
      
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-11-26T00:00:00+01:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
      </p>
    
    
    <h1 class="entry-title" itemprop="name headline">
        Parallelism
        
    </h1>
    
  </header>


<div class="entry-content clearfix" itemprop="articleBody description"><div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Installation</a>
<ul>
<li><a href="#sec-1-1">1.1. Local Machine</a></li>
<li><a href="#sec-1-2">1.2. Virtual Machine</a></li>
</ul>
</li>
<li><a href="#sec-2">2. Ocatve</a></li>
<li><a href="#sec-3">3. C</a></li>
<li><a href="#sec-4">4. Performance Comparison</a></li>
</ul>
</div>
</div>
<p>
In this article, I will introduce the installation and basic use of MPI
framework through octave. Matlab is widely used in many scientific
domains as it enables the developers focus on the algorithms other
than programming skills. However, the support of parallelism computing
from Matlab is limited and expensive, especially for computing on
clusters. Currently, two parallelism frameworks are widely used: MPI
(Message Passage Interface) and MapReduce. Hadoop, which is an Java
implementation of MapReduce, does not currently support Matlab or
Octave. Therefore, I choose the MPI + Octave as a parallelism solution
for Matlab users.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><a href="xiaoliuai.github.io/blog/2014-11-26-parallelism.html"><span class="section-number-2">1</span> Installation</a></h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Local Machine</h3>
<div class="outline-text-3" id="text-1-1">
<ul class="org-ul">
<li>Install open-mpi.
<ul class="org-ul">
<li>On Mac OS X with homebrew, <code>brew install open-mpi</code>
</li>
<li>On Ubuntu, the direct way is install the packages via package
manager <code>sudo apt-get install openmpi-bin openmpi-common
        openmpi-checkpoint libopenmpi-dev libopenmpi-X.X</code>. However,
the OpenMPI installed through this method does not work with
the octave-mpi package due to a library linkage problem. A
fast cue is compiling and installing it manually.
Download the openmpi package <a href="http://www.open-mpi.org/software/ompi/v1.8/">openmpi-1.8.3.tar.gz</a>.
<div class="org-src-container">

<pre class="src src-bash">tar xzvf openmpi-1.8.3.tar.gz
cd openmpi-1.8.3
./configure --dsiable-dlopen
make
sudo make install
</pre>
</div>
</li>
</ul>
</li>
<li>Install octave
<ul class="org-ul">
<li>On Mac OS X with homebrew
<ol class="org-ol">
<li>install XQuartz from image file downloaded from <a href="http://xquartz.macosforge.org/landing/">http://xquartz.macosforge.org/landing/</a>.
</li>
<li><code>brew tap homebrew/science</code>
</li>
<li>install gfortran <code>brew install gcc</code>
</li>
<li><code>brew install octave</code>
</li>
</ol>
</li>
<li>On Ubuntu
<code>sudo apt-get install octave</code>
</li>
</ul>
</li>
<li>Install octave mpi package
<ul class="org-ul">
<li>Inside octave
<div class="org-src-container">

<pre class="src src-octave">putenv (<span style="color: #2aa198;">"PATH"</span><span style="color: #6c71c4;">,</span> [<span style="color: #2aa198;">"path/to/mpic++/:"</span> getenv(<span style="color: #2aa198;">"PATH"</span>)]) <span style="color: #93a1a1; font-style: italic;">% optional</span>&#57344;&#57345;&#57345;
pkg install <span style="color: #6c71c4;">-</span>forge mpi      <span style="color: #93a1a1; font-style: italic;">% install mpi from internet or</span>&#57344;&#57345;&#57345;
pkg install PATH<span style="color: #6c71c4;">/</span>TO<span style="color: #6c71c4;">/</span>PACKAGE <span style="color: #93a1a1; font-style: italic;">% install mpi from downloaded package</span>&#57344;&#57345;&#57345;
</pre>
</div>
</li>
<li>Through package manager in Ubuntu (deprecated), run <code>apt-get
        install octave-openmpi-ext</code>. As the pakcage manager could
automatically install the OpenMPI package, which does not work
with the octave-mpi actually, we suggest do NOT use this
method.
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Virtual Machine</h3>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Ocatve</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li>Run octave code with mpi.
<ul class="org-ul">
<li>First way is run code from shell/terminal/ssh.
<div class="org-src-container">

<pre class="src src-bash">mpirun [OPTIONS] octave -q --eval '[octave code, function or script name]'
</pre>
</div>
</li>
<li>Second way is call the system command inside octave.
<div class="org-src-container">

<pre class="src src-octave">system (<span style="color: #2aa198;">"mpirun octave -q --eval '[octave code, function or script name]"</span>)<span style="color: #6c71c4;">;</span>&#57344;&#57345;
</pre>
</div>
</li>
<li>Octave mpi package contains some simple examples to show you
how to write the octave code that enables the parallelism via
MPI. These codes are in two possible locations if you install
the octave mpi package globally:
<ul class="org-ul">
<li><code>/usr/share/doc/octave-mpi/examples/</code>
</li>
<li><code>/usr/share/octave/packages/mpi-1.2.0/</code>
</li>
</ul>
<p>
If you install the package under user&#8217;s home folder, you can
find exmaple codes under <code>$HOME/octave/packages/mpi-1.2.0/</code>. To
test the example inside octave, run command
<code>system ("mpirun octave -q --eval 'pkg load mpi; helloworld
       ()'");</code>
</p>
</li>
<li>Frequently used mpirun options: <code>--hostfile</code> indicate the file
that contains the hostnames of cluster; <code>-np</code> number of
processes to run.
</li>
</ul>
</li>

<li>The interface provided by octave mpi package is a subset of all
MPI functions. How to parallelize the code?
Example 1, basic example about initializing the environment, send
and receive messages/variables. Basically, these functions are
enough to create the parallelism program.
<div class="org-src-container">

<pre class="src src-octave">MPI_Init()<span style="color: #6c71c4;">;</span>&#57344;&#57345;&#57345;
communicator <span style="color: #6c71c4;">=</span> MPI_Comm_Load(<span style="color: #2aa198;">"a label string"</span>) <span style="color: #93a1a1; font-style: italic;">% one can use multiple communicators indicated by different label</span>&#57344;&#57345;
my_rank <span style="color: #6c71c4;">=</span> MPI_Comm_rank(communicator) <span style="color: #93a1a1; font-style: italic;">% rank is the indicator(id) of current process</span>&#57344;&#57345;
p <span style="color: #6c71c4;">=</span> MPI_Comm_size(CW) <span style="color: #93a1a1; font-style: italic;">% the size of a communicator is the number of processes handled by the communicator</span>&#57344;&#57345;
[info] <span style="color: #6c71c4;">=</span> MPI_Send(value<span style="color: #6c71c4;">,</span> ranks<span style="color: #6c71c4;">,</span> TAG<span style="color: #6c71c4;">,</span> communicator)<span style="color: #6c71c4;">;</span>&#57344;&#57345;&#57345;
<span style="color: #93a1a1; font-style: italic;">% </span><span style="color: #93a1a1; font-style: italic;">value:  a octave variable</span>&#57344;&#57345;&#57345;
<span style="color: #93a1a1; font-style: italic;">% </span><span style="color: #93a1a1; font-style: italic;">ranks:  a vector that contains the id of destination processes, can be an integer</span>&#57344;&#57345;
<span style="color: #93a1a1; font-style: italic;">% </span><span style="color: #93a1a1; font-style: italic;">TAG:    an integer to identify the message (when there are many messages sent in the same context)</span>&#57344;&#57345;
<span style="color: #93a1a1; font-style: italic;">% </span><span style="color: #93a1a1; font-style: italic;">info:   an integer that indicates the success of failure state of process</span>&#57344;&#57345;
[value<span style="color: #6c71c4;">,</span> info] <span style="color: #6c71c4;">=</span> MPI_Recv(source<span style="color: #6c71c4;">,</span> TAG<span style="color: #6c71c4;">,</span> communicator)&#57344;&#57345;&#57345;
<span style="color: #93a1a1; font-style: italic;">% </span><span style="color: #93a1a1; font-style: italic;">source: the id the process that send this message</span>&#57344;&#57345;&#57345;
<span style="color: #93a1a1; font-style: italic;">%         </span><span style="color: #93a1a1; font-style: italic;">receive from any process if source is -1</span>&#57344;&#57345;&#57345;
<span style="color: #93a1a1; font-style: italic;">%         </span><span style="color: #93a1a1; font-style: italic;">process starts from 0 and process 0 is usually used as master process</span>&#57344;&#57345;
<span style="color: #93a1a1; font-style: italic;">% </span><span style="color: #93a1a1; font-style: italic;">value:  received variable</span>&#57344;&#57345;&#57345;
MPI_Finalize()&#57344;&#57345;&#57345;
</pre>
</div>

<p>
Process sequence control functions:
</p>
<ul class="org-ul">
<li>Function <code>MPI_Barrier(communicator)</code> will block the process until
all the processes reached this location.
</li>

<li>Function <code>MPI_Probe(RANK, TAG, COMM)</code> test if process [RANK] send
a message with TAG from communicator COMM. Block the process if
no message arrive.
</li>

<li>Function <code>MPI_Iprobe(RANK, TAG, COMM)</code> test if process [RANK] send
a message with TAG from communicator COMM. NOT block the process
if no message arrive.
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> C</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li>Point-to-point communication
<ul class="org-ul">
<li>blocked
</li>
<li>non-blocked
</li>
</ul>
</li>
<li>Collective communication
<ul class="org-ul">
<li>MPI_Reduce
</li>
<li>MPI_Scatter
</li>
</ul>
</li>
<li>Derived data type
</li>
<li>Group and communicator management
</li>
<li>Virtual topology routine
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Performance Comparison</h2>
<div class="outline-text-2" id="text-4">
<p>
<iframe
src="https://docs.google.com/spreadsheets/d/1kOLf_azmw872VHm6lmOxsPUvpD0hs-ZvbPUJDOjMBFM/pubhtml?gid=0&amp;single=true&amp;widget=true&amp;headers=false"
width="900" height="600"></iframe>
</p>
</div>
</div>
</div>


      <footer>
        <p class="meta text-muted">
          
  

<span class="glyphicon glyphicon-user"></span> <span class="byline author vcard" itemprop="author" itemscope itemtype="http://schema.org/Person">Posted by <span class="fn" itemprop="name">Xiao Liu</span></span>

          












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-11-26T00:00:00+01:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
          

<span class="glyphicon glyphicon-tags"></span>&nbsp;
<span class="categories">
  
    <a class='category' href='/blog/categories/parallelism/'>parallelism</a>
  
</span>


        </p>
        
          <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://xiaoliuai.github.io/blog/2014-11-26-parallelism.html" data-via="" data-counturl="http://xiaoliuai.github.io/blog/2014-11-26-parallelism.html" >Tweet</a>
  
  
  
</div>

        
        
          <ul class="meta text-muted pager">
            
            <li class="previous"><a href="/blog/2014-10-29-writing-blog-using-org-mode-and-octopress.html" title="Previous Post: Writing Blog Using Org-mode and Octopress">&laquo; Writing Blog Using Org-mode and Octopress</a></li>
            
            
          </ul>
        
      </footer>
    </article>
    
  </div>

  
  <aside class="sidebar col-md-3">
    
      <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item active" href="/blog/2014-11-26-parallelism.html">Parallelism</a>
    
    <a class="list-group-item " href="/blog/2014-10-29-writing-blog-using-org-mode-and-octopress.html">Writing Blog Using Org-mode and Octopress</a>
    
    <a class="list-group-item " href="/blog/2014-10-29-initialize-the-first-blog.html">Initialize the First Blog</a>
    
  </div>
</section>

<section class="panel panel-default clearfix">
  <div class="panel-heading">
      <h3 class="panel-title">GitHub Repos</h3>
  </div>
  <div class="list-group" id="gh_repos">
    <p class="loading">Status updating&#8230;</p>
  </div>
  
    <div class="gh-profile-link pull-right text-muted">
      <a href="https://github.com/xiaoliuai">@xiaoliuai</a> on GitHub
    </div>
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'xiaoliuai',
            count: 2,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Categories</h3>
  </div>
  <div class="list-group">
    
    
    <a class="list-group-item " href="/blog/categories/geek/index.html">
        <span class="badge">2</span>
        geek
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/parallelism/index.html">
        <span class="badge">1</span>
        parallelism
      </a>
    
  </div>
</section>
<section class="panel panel-default">
        <div class="panel-heading">
                <h2 class="panel-title">标签列表</h2>
        </div>
        <div class="list-group">
                        <ul class="tag-cloud">
                                <a style="font-size: 210%" href="/tags/github/">GitHub</a>
<a style="font-size: 90%" href="/tags/jekyll/">Jekyll</a>
<a style="font-size: 90%" href="/tags/mpi/">MPI</a>
<a style="font-size: 90%" href="/tags/matlab/">Matlab</a>
<a style="font-size: 90%" href="/tags/octave/">Octave</a>
<a style="font-size: 90%" href="/tags/octopress/">Octopress</a>
<a style="font-size: 210%" href="/tags/org-mode/">Org-mode</a>

                        </ul>
        </div>
</section>

    
  </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2014 - Xiao Liu<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>


  </body>
</html>
